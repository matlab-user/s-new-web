<!DOCTYPE html>

<html>

    <head>
		<meta charset="UTF-8" http-equiv="X-UA-Compatible" content="IE=edge">
		<title>实唯物联</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
		<script src="my-js/devs_view/devs_view.js"></script>
		<script src="js-lib/jquery.base64.js"></script>
		
		<style type='text/css'>
			.button_1{margin-left:220px;width:80px;height:30px;background:#eee;}
			.button_1:hover{background:#aaa;}
			.normal{opacity:0.9;}
			#float_div{border-radius:5px;background:#dcdcdc}
			#add_dev_table td{padding:9px 9px 5px 9px;}
		</style>
		
		<script>
			var view = 'list';					// 显示模式 list icon
			$( function() {
				$('#alarm_ul').hide();
				$('#float_div').hide();
				
				$('#float_div').click( function(e) {
					var t_id = e.target.id;
					if( t_id==='add_dev_id' || t_id==='add_dev_rcode' ) {
						e.stopPropagation();
						return;
					}
						
					if( $('#add_dev_id').val()=='' )
						$('#add_dev_id').val( 'guid1' );
					
					if( $('#add_dev_rcode').val()=='' )
						$('#add_dev_rcode').val( '注册码' );
						
					e.stopPropagation();
				} );
				
				$('body').click( function() {
					var div = $('#float_div');
					if( div.is(":visible") ) {
						$('#float_div input').attr('change','0');
						$('#add_dev_id').val('guid1');
						$('#add_dev_rcode').val('注册码');
						div.hide();
					}
				} );
				
				$('#float_div input').focus( function(e) {
					if( $(this).attr('change')!='1' )
						$(this).val('');
					e.stopPropagation();
				} );
				
				$('#float_div input').change( function() {
					$(this).attr('change','1');
				} );
				
				$('#submit').click( function() {
				
					var g1 = $('#add_dev_id').val();
					var rcode = $('#add_dev_rcode').val();
					
					$.post( 'my-php/devs_view/add_dev.php', {'g1':g1,'rcode':rcode}, function( data ) {
						if( data.length>3 ) {
							var dev_info = new Array();
							dev_info = data.split( ',' );
							devs.push( {'g1':dev_info[0],'name':dev_info[1],'tz':8,'lt':'N','state':'running'} );
							
							var devs_table = $('#devices1').children('table.devs_table').children('tbody');
							add_dev_tr( devs_table, devs.length-1 );
							
							
						}
					} );
				} );
			
				$.post( 'my-php/devs_view_init.php', function( res ) {
					xml_parser( res );
					$('#devs_info_bar').text('您目前共有'+devs.length+'台设备');
					var devs_table = $('#devices1').children('table.devs_table').children('tbody');
					$.each( devs, function(i,v) {
						add_dev_tr( devs_table, i );
					} );				
				} );
				
				$.post( "my-php/get_user.php", function( data ) {
					if( data=='' )
						return;
					user = data;
					$('#user_name').html( user );
				} );
	
				$('#add_dev_bn').click( function(e) { add_dev(e); } );
			} );
		</script>
    </head>

    <body>

        <header class="header">
			<img class='logo' height=50 src='image/login/swaytech.png' />

			<ul class="nav">
				<li><a href="devs_view.html">监控中心</a></li>
				<li><a href="user.php">个人资料</a></li>
			</ul>

			<ul class="nav right">
				<li id='user_name'>User.Name</li>
				<li><a href="login.html" class="login-out">注销</a></li>
			</ul>
        </header>
		
		<div class="adminbar">
			<p class="title">
				<strong>我的设备</strong>
			</p>

			<ul class="nav admin">
				<li><a class="operation-control" href="#operation-control">设备控制</a></li>
				<li><a class="operation-setting" href="#operation-setting">设备设置</a></li>
				<li><a target='_blank' class='data-query' href='data_query.html' >数据查询</a></li>
				<!--<li><a class="operation-data" href="#operation-data">操作记录</a></li>-->
			</ul>
			
			<p class="title">
				<span id='devs_info_bar' style="padding-left:200px;" ></span>
			</p> 
			
			<ul class="button" style='margin-left:20%;float:left;'>
				<li><button class="refresh" onclick="apply_dev()">申请新设备</button></li>
				<li><button class="refresh" id='add_dev_bn'>添加新设备</button></li>
			</ul>
			
			<ul class="button">
				<li><button class="refresh" onclick="change_view()">视图切换</button></li>
				<li><button class="refresh" onclick="refresh()">刷新</button></li>
			</ul>
		
		</div>
		
		<div id="devices1">
			<table class="default devs_table hover_table">
				<tbody>
					<tr>
						<th width="25%">设备名称</th>
						<th width="25%">设备ID</th>
						<th width="20%">状态</th>
						<th width="20%">更新时间</th>
						<th width="10%">操作</th>
					</tr>
				</tbody>
			</table>
		</div>

		<ul id='alarm_ul'><li></li></ul>
		
		<div id='float_div' class='login'>
			<table id='add_dev_table'>
				<tr><td><input id='add_dev_id' class="normal" type="text" value='guid1'/></td></tr>
				<tr><td><input id='add_dev_rcode' class="normal" type="text" value='注册码'/></td></tr>
				<tr><td><button id='submit' class='button_1'>确 定</button></td></tr>
			</table>
		</div>
	
	</body>
	
</html>